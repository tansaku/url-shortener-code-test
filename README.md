# Url Shortener Code Test

A basic api to shorten URIs

## Requirements

The code is written and tested against:

* [Ruby](https://www.ruby-lang.org/) 2.6.5
* [Rails](https://rubyonrails.org/) 6.0.2

## Installation

1. Clone the repository

```sh
$ git clone https://github.com/tansaku/url-shortener-code-test
```

2. Move into directory and install dependencies

```sh
$ cd url-shortener-code-test
$ bundle
```

3. Start the server

```sh
$ bundle exec rails server -p 4000
```

Note: you may need to run `yarn install --check-files` to update yarn packages locally

4. Interact with the API via curl

- the main endpoint responds to `POST` with a json body
  containing a URL, which responds with a JSON repsonse of the short url and
  the orignal URL, as in the following curl example:

```
curl localhost:4000 -XPOST -d '{ "url": "http://www.farmdrop.com" }'
{ "short_url": "/bcbb5f", "url": "http://www.farmdrop.com" }
```

- When you send a GET request to a previously returned URL, it redirects
  to the POSTed URL, as shown in the following curl example:

```
curl -v localhost:4000/bcbb5f
...
< HTTP/1.1 301 Moved Permanently
...
< Location: http://www.farmdrop.com
...
{ "url": "http://www.farmdrop.com" }
```
## Features

* Shortened URLs are generated by using the first 6 characters from an md5 hash of the URL
* URLs are automatically prefixed with 'http://' if that is missing from the original submission

## Approach

Rails is a rather heavyweight approach here (i.e. it has more power than we really need), but great for a really quick prototype.  I've used request specs that operate at the integration level and give us reasonable confidence in the operation of the system.  The system is simple enough and I'm time constrained enough that I haven't broken out units tests except to demonstrate the principle of single responsibility.  Clearly the string manipulation code in the private part of the controller could be in a utils file under separate unit tests.  I'm not particularly happy with the way the code is split up in the controller, but it's doing the job and each method is less than five lines in length.  With more time I'd sure I'd be able to create a more readable structure.

Also, if ability to respond to the precise curl commands specified is how the system would be used then it might make sense to have acceptance tests that actually use curl since it took some tweaking of the Rails request specs to have them properly check for the same sorts of things that are required for the raw curl interactions.  I've ensured that the Rails app can handle the raw json input and isn't dependent on Rails safeguards like authenticity tokens, but that's been a manual matching and a more robust acceptance test might involve using actual curl.

Naturally taking the first few characters of an MD5 hash increases the chance of a hash collision, but this quick and dirty approach seems fine for this small app as a proof of concept.

## Running the tests

The code can be tested as follows

```sh
$ bundle exec rake
```

And should give output like the following which includes linting via rubocop and test coverage via simplecov:

```sh
Running RuboCop...
Inspecting 15 files
...............

15 files inspected, no offenses detected
/Users/tansaku/.rvm/rubies/ruby-2.6.5/bin/ruby -I/Users/tansaku/.rvm/gems/ruby-2.6.5/gems/rspec-core-3.9.1/lib:/Users/tansaku/.rvm/gems/ruby-2.6.5/gems/rspec-support-3.9.2/lib /Users/tansaku/.rvm/gems/ruby-2.6.5/gems/rspec-core-3.9.1/exe/rspec --pattern spec/\*\*\{,/\*/\*\*\}/\*_spec.rb

Url Shortener
  POST /
    should shorten urls
    should handle lack of http prefix gracefully
    should handle empty string gracefully
    should handle no url gracefully
  GET /<shortened_url>
    should redirect to original URL
    handles case when there is no original URL

Finished in 0.08346 seconds (files took 2.41 seconds to load)
6 examples, 0 failures

COVERAGE: 100.00% -- 76/76 lines in 18 files
```

## TODO

* [x] handle presence/absence of http:// prefix
* [x] test error paths
* [ ] refactor more code out of controller
* [ ] extract magic strings to constants
* [ ] unit tests
* [ ] add acceptance tests using curl (in cucumber?)
* [ ] dockerfile with heroku deploy?
* [ ] little react frontend?

## Original Instructions

Without using an external database, we'd like you to create a URL shortening
service. The URLs do not need to persist between restarts, but should be
shareable between different clients while the server is running.

- There should be an endpoint that responds to `POST` with a json body
  containing a URL, which responds with a JSON repsonse of the short url and
  the orignal URL, as in the following curl example:

```
curl localhost:4000 -XPOST -d '{ "url": "http://www.farmdrop.com" }'
{ "short_url": "/abc123", "url": "http://www.farmdrop.com" }
```


- When you send a GET request to a previously returned URL, it should redirect
  to the POSTed URL, as shown in the following curl example:

```
curl -v localhost:4000/abc123
...
< HTTP/1.1 301 Moved Permanently
...
< Location: http://www.farmdrop.com
...
{ "url": "http://www.farmdrop.com" }
```

Use whatever languages and frameworks you are comfortable with. Don't worry
about getting the whole thing working flawlessly, this is more to see how you
structure a program. Please don't spend more than a few hours on it.

Bonus points:

- I often forget to type "http://" at the start of a URL. It would be nice if
  this was handled by the application (frontend or backend is up to you).
- We like to see how you approach the problem, so a few git commits with a
  clear message about what you're doing are better than one git commit with
  everything in it.
- We like tests. We don't expect a full test suite, but some tests would be
  nice to see. Its up to you whether thats integration, unit or some other
  level of testing.
- We'd be very happy to see a Dockerfile to run the project. This by no means a
  requirement, so don't go reading the Docker docs if you've never worked with
  it.
- If you'd like to show off your frontend skills, you could create a simple
  frontend that can create and display shortened URLs without reloading the
  page.

## Submission

Please clone this repository, write some code and update this README with a
guide of how to run it.

Either send us a link to the repository on somewhere like github or bitbucket
(bitbucket has free private repositories) or send us a git bundle.

    git bundle create yournamehere-url-shortener-test.bundle master

And send us the resulting `yournamehere-url-shortener-test.bundle` file.

This `.bundle` file can be cloned using:

    git bundle clone bundle-filename.bundle -b master directory-name
